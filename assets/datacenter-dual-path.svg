<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 400">
  <defs>
    <linearGradient id="edgeGd" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#4ecdc4;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#2ab7aa;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="supGd" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#00ADD8;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#007d9c;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="mqttGd" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#22c55e;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#16a34a;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="dnp3Gd" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#f97316;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#ea580c;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="sqlGd" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#ff6b6b;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#c44545;stop-opacity:1" />
    </linearGradient>
    <marker id="aMqtt" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#22c55e"/>
    </marker>
    <marker id="aDnp3" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#f97316"/>
    </marker>
    <marker id="aWhite" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#fff"/>
    </marker>
    <filter id="glowD">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.3"/>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="800" height="400" fill="#1a1a2e" rx="10"/>

  <!-- Title -->
  <text x="400" y="30" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="20" font-weight="bold">
    Dual-Path Communication: MQTT + DNP3 Store-and-Forward
  </text>

  <!-- Edge Module -->
  <g filter="url(#glowD)">
    <rect x="30" y="60" width="280" height="280" fill="#222" rx="10" stroke="#4ecdc4" stroke-width="2"/>
    <rect x="80" y="70" width="180" height="30" fill="url(#edgeGd)" rx="6"/>
    <text x="170" y="91" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="14" font-weight="bold">Edge Module (Pod A1)</text>

    <!-- MQTT Publisher -->
    <rect x="50" y="120" width="240" height="55" fill="#334" rx="6" stroke="#22c55e" stroke-width="1.5"/>
    <text x="170" y="140" text-anchor="middle" fill="#22c55e" font-family="Arial, sans-serif" font-size="12" font-weight="bold">MQTT Publisher</text>
    <text x="170" y="165" text-anchor="middle" fill="#888" font-family="monospace" font-size="9">dc/module-a1/crac/supply_temp</text>

    <!-- DNP3 Outstation -->
    <rect x="50" y="190" width="240" height="55" fill="#334" rx="6" stroke="#f97316" stroke-width="1.5"/>
    <text x="170" y="210" text-anchor="middle" fill="#f97316" font-family="Arial, sans-serif" font-size="12" font-weight="bold">DNP3 Outstation</text>
    <text x="170" y="235" text-anchor="middle" fill="#888" font-family="monospace" font-size="9">Class 1/2/3 event buffering</text>

    <!-- SQLite buffer -->
    <rect x="70" y="260" width="200" height="55" fill="#334" rx="6" stroke="#ff6b6b" stroke-width="1.5"/>
    <rect x="85" y="270" width="30" height="25" fill="url(#sqlGd)" rx="3"/>
    <text x="100" y="288" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="8" font-weight="bold">SQL</text>
    <text x="195" y="283" text-anchor="middle" fill="#ff6b6b" font-family="Arial, sans-serif" font-size="11" font-weight="bold">Store-and-Forward</text>
    <text x="195" y="300" text-anchor="middle" fill="#888" font-family="monospace" font-size="8">SQLite WAL | GZIP | AES-256-GCM</text>
    <text x="195" y="310" text-anchor="middle" fill="#666" font-family="monospace" font-size="8">Survives power loss</text>
  </g>

  <!-- Supervisor -->
  <g filter="url(#glowD)">
    <rect x="530" y="60" width="240" height="170" fill="#222" rx="10" stroke="#00ADD8" stroke-width="2"/>
    <rect x="580" y="70" width="140" height="30" fill="url(#supGd)" rx="6"/>
    <text x="650" y="91" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="14" font-weight="bold">Site Supervisor</text>

    <!-- MQTT Subscriber -->
    <rect x="550" y="115" width="200" height="40" fill="#334" rx="6" stroke="#22c55e" stroke-width="1.5"/>
    <text x="650" y="135" text-anchor="middle" fill="#22c55e" font-family="Arial, sans-serif" font-size="11" font-weight="bold">MQTT Subscriber</text>
    <text x="650" y="150" text-anchor="middle" fill="#888" font-family="monospace" font-size="9">dc/module-a1/#</text>

    <!-- DNP3 Master -->
    <rect x="550" y="165" width="200" height="40" fill="#334" rx="6" stroke="#f97316" stroke-width="1.5"/>
    <text x="650" y="185" text-anchor="middle" fill="#f97316" font-family="Arial, sans-serif" font-size="11" font-weight="bold">DNP3 Master</text>
    <text x="650" y="200" text-anchor="middle" fill="#888" font-family="monospace" font-size="9">Polls on MQTT staleness</text>
  </g>

  <!-- MQTT path (green, solid, top) -->
  <line x1="290" y1="147" x2="530" y2="135" stroke="#22c55e" stroke-width="3" marker-end="url(#aMqtt)"/>
  <rect x="360" y="115" width="120" height="24" fill="#22c55e" rx="5" fill-opacity="0.15"/>
  <text x="420" y="132" text-anchor="middle" fill="#22c55e" font-family="Arial, sans-serif" font-size="11" font-weight="bold">PRIMARY</text>
  <text x="420" y="105" text-anchor="middle" fill="#22c55e" font-family="monospace" font-size="9">Sub-second latency</text>

  <!-- DNP3 path (orange, dashed, bottom) -->
  <line x1="290" y1="217" x2="530" y2="185" stroke="#f97316" stroke-width="3" stroke-dasharray="10,5" marker-end="url(#aDnp3)"/>
  <rect x="355" y="195" width="130" height="24" fill="#f97316" rx="5" fill-opacity="0.15"/>
  <text x="420" y="212" text-anchor="middle" fill="#f97316" font-family="Arial, sans-serif" font-size="11" font-weight="bold">BACKUP</text>
  <text x="420" y="232" text-anchor="middle" fill="#f97316" font-family="monospace" font-size="9">Event-buffered, timestamped</text>

  <!-- Network failure scenario -->
  <rect x="530" y="260" width="240" height="120" fill="#181828" rx="8" stroke="#444" stroke-width="1"/>
  <text x="650" y="282" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="12" font-weight="bold">On Network Disruption</text>

  <text x="550" y="302" fill="#ef4444" font-family="Arial, sans-serif" font-size="10">1. MQTT path fails</text>
  <text x="550" y="320" fill="#f97316" font-family="Arial, sans-serif" font-size="10">2. Events buffer in SQLite</text>
  <text x="550" y="338" fill="#f97316" font-family="Arial, sans-serif" font-size="10">3. Original timestamps preserved</text>
  <text x="550" y="356" fill="#22c55e" font-family="Arial, sans-serif" font-size="10">4. Network restored â†’ DNP3 delivers</text>
  <text x="550" y="374" fill="#22c55e" font-family="Arial, sans-serif" font-size="10">5. Zero data loss, ordered history</text>

  <!-- X on MQTT to show failure -->
  <text x="370" y="160" fill="#ef4444" font-family="Arial, sans-serif" font-size="24" font-weight="bold">X</text>
  <text x="385" y="170" fill="#ef4444" font-family="Arial, sans-serif" font-size="9">Broker down?</text>
</svg>
