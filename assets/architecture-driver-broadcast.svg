<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 380">
  <defs>
    <linearGradient id="plcGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#00ADD8;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#007d9c;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="serverGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#4ecdc4;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#2ab7aa;stop-opacity:1" />
    </linearGradient>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#ff6b6b"/>
    </marker>
    <marker id="arrowGreen" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#4ecdc4"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="800" height="380" fill="#1a1a2e" rx="10"/>

  <!-- Title -->
  <text x="400" y="35" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="20" font-weight="bold">
    Driver Manager Broadcast Architecture
  </text>

  <!-- PLC Core Box -->
  <rect x="50" y="80" width="200" height="200" fill="#222" rx="10" stroke="#00ADD8" stroke-width="2"/>
  <text x="150" y="110" text-anchor="middle" fill="#00ADD8" font-family="Arial, sans-serif" font-size="16" font-weight="bold">PLC Runtime</text>

  <!-- I/O Memory -->
  <rect x="70" y="130" width="160" height="60" fill="#333" rx="5"/>
  <text x="150" y="155" text-anchor="middle" fill="#fff" font-family="monospace" font-size="12">I/O Memory</text>
  <text x="150" y="175" text-anchor="middle" fill="#888" font-family="monospace" font-size="10">%QW0-99 = [data]</text>

  <!-- GSV Box -->
  <rect x="70" y="200" width="160" height="40" fill="#333" rx="5"/>
  <text x="150" y="225" text-anchor="middle" fill="#4ecdc4" font-family="monospace" font-size="11">GSV_TASKSCANTIME()</text>

  <!-- Scan Time -->
  <text x="150" y="265" text-anchor="middle" fill="#888" font-family="Arial, sans-serif" font-size="11">Scan: 30µs avg</text>

  <!-- Driver Manager -->
  <rect x="300" y="100" width="140" height="160" fill="#333" rx="10" stroke="#ff6b6b" stroke-width="2"/>
  <text x="370" y="130" text-anchor="middle" fill="#ff6b6b" font-family="Arial, sans-serif" font-size="14" font-weight="bold">Driver</text>
  <text x="370" y="150" text-anchor="middle" fill="#ff6b6b" font-family="Arial, sans-serif" font-size="14" font-weight="bold">Manager</text>

  <text x="370" y="180" text-anchor="middle" fill="#888" font-family="Arial, sans-serif" font-size="11">EndScan()</text>
  <text x="370" y="200" text-anchor="middle" fill="#888" font-family="Arial, sans-serif" font-size="10">↓</text>
  <text x="370" y="220" text-anchor="middle" fill="#4ecdc4" font-family="Arial, sans-serif" font-size="11">Broadcast to</text>
  <text x="370" y="240" text-anchor="middle" fill="#4ecdc4" font-family="Arial, sans-serif" font-size="11">ALL drivers</text>

  <!-- Arrow from PLC to Driver Manager -->
  <line x1="250" y1="160" x2="295" y2="160" stroke="#ff6b6b" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Modbus Servers -->
  <g>
    <!-- Server 1 -->
    <rect x="500" y="60" width="120" height="50" fill="url(#serverGrad)" rx="5"/>
    <text x="560" y="85" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="12" font-weight="bold">Port 7000</text>
    <text x="560" y="100" text-anchor="middle" fill="#1a1a2e" font-family="Arial, sans-serif" font-size="10">HR[0-99]</text>

    <!-- Server 2 -->
    <rect x="500" y="120" width="120" height="50" fill="url(#serverGrad)" rx="5"/>
    <text x="560" y="145" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="12" font-weight="bold">Port 7001</text>
    <text x="560" y="160" text-anchor="middle" fill="#1a1a2e" font-family="Arial, sans-serif" font-size="10">HR[0-99]</text>

    <!-- Dots -->
    <text x="560" y="195" text-anchor="middle" fill="#888" font-family="Arial, sans-serif" font-size="20">⋮</text>

    <!-- Server N -->
    <rect x="500" y="210" width="120" height="50" fill="url(#serverGrad)" rx="5"/>
    <text x="560" y="235" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="12" font-weight="bold">Port 11999</text>
    <text x="560" y="250" text-anchor="middle" fill="#1a1a2e" font-family="Arial, sans-serif" font-size="10">HR[0-99]</text>
  </g>

  <!-- 5000 label -->
  <rect x="640" y="130" width="80" height="30" fill="#ff6b6b" rx="5"/>
  <text x="680" y="150" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="14" font-weight="bold">x 5000</text>

  <!-- Arrows from Driver Manager to Servers -->
  <path d="M 440 130 Q 470 85 495 85" stroke="#4ecdc4" stroke-width="2" fill="none" marker-end="url(#arrowGreen)"/>
  <path d="M 440 160 L 495 145" stroke="#4ecdc4" stroke-width="2" marker-end="url(#arrowGreen)"/>
  <path d="M 440 190 Q 470 235 495 235" stroke="#4ecdc4" stroke-width="2" fill="none" marker-end="url(#arrowGreen)"/>

  <!-- Legend -->
  <rect x="50" y="300" width="700" height="70" fill="#222" rx="5"/>

  <!-- Legend row 1 - icons -->
  <circle cx="150" cy="320" r="8" fill="#ff6b6b"/>
  <text x="165" y="325" fill="#888" font-family="Arial, sans-serif" font-size="11">Output Sync</text>
  <circle cx="350" cy="320" r="8" fill="#4ecdc4"/>
  <text x="365" y="325" fill="#888" font-family="Arial, sans-serif" font-size="11">Broadcast Write</text>
  <rect x="530" y="312" width="60" height="16" fill="url(#serverGrad)" rx="3"/>
  <text x="600" y="325" fill="#888" font-family="Arial, sans-serif" font-size="11">Modbus Server</text>

  <!-- Legend row 2 - description -->
  <text x="400" y="355" fill="#666" font-family="Arial, sans-serif" font-size="11" text-anchor="middle">
    Same %QW0-99 data written to ALL 5000 servers simultaneously
  </text>
</svg>
